<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Colaboradores - BlockHub</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital,wght@0,100..700;1,100..700&display=swap"
        rel="stylesheet">

    <style>
        :root {
            --primary-color: #013EFB;
            --secondary-color: #90F209;
            --dark-navy: #01112B;
            --deep-black: #000000;
            --almost-black: #0a0a0a;
            --dark-charcoal: #1a1a1a;
            --light-gray: #EBEBEB;
            --glass-bg: rgba(235, 235, 235, 0.1);
            --glass-border: rgba(235, 235, 235, 0.2);
            --dark-glass: rgba(1, 17, 43, 0.3);
            --text-light: rgba(235, 235, 235, 0.95);
            --text-muted: rgba(235, 235, 235, 0.75);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto Mono', monospace;
            background: linear-gradient(135deg, var(--deep-black) 0%, var(--almost-black) 25%, var(--dark-charcoal) 40%, var(--dark-navy) 70%, var(--primary-color) 100%);
            min-height: 100vh;
            overflow-x: hidden;
            color: var(--text-light);
        }

        /* Animated Background */
        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: linear-gradient(135deg, var(--deep-black) 0%, var(--almost-black) 20%, var(--dark-charcoal) 35%, var(--dark-navy) 55%, var(--primary-color) 75%, var(--secondary-color) 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
        }

        @keyframes gradientShift {

            0%,
            100% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }
        }

        /* Floating cubes animation */
        .bg-cube {
            position: absolute;
            width: 60px;
            height: 60px;
            border-radius: 12px;
            opacity: 0.4;
            animation: bgCubeFloat 8s ease-in-out infinite;
        }

        .bg-cube:nth-child(1) {
            top: 10%;
            left: 15%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            animation-delay: 0s;
            box-shadow: 0 8px 25px rgba(1, 62, 251, 0.3);
        }

        .bg-cube:nth-child(2) {
            top: 60%;
            right: 20%;
            background: linear-gradient(135deg, var(--secondary-color), var(--primary-color));
            animation-delay: 2s;
            box-shadow: 0 8px 25px rgba(144, 242, 9, 0.3);
            width: 80px;
            height: 80px;
        }

        .bg-cube:nth-child(3) {
            bottom: 20%;
            left: 25%;
            background: linear-gradient(135deg, var(--dark-navy), var(--primary-color));
            animation-delay: 4s;
            box-shadow: 0 8px 25px rgba(1, 17, 43, 0.3);
            width: 50px;
            height: 50px;
        }

        @keyframes bgCubeFloat {

            0%,
            100% {
                transform: translateY(0px) rotate(0deg) scale(1);
                opacity: 0.4;
            }

            25% {
                transform: translateY(-15px) rotate(45deg) scale(1.1);
                opacity: 0.6;
            }

            50% {
                transform: translateY(-30px) rotate(90deg) scale(0.9);
                opacity: 0.3;
            }

            75% {
                transform: translateY(-15px) rotate(135deg) scale(1.05);
                opacity: 0.5;
            }
        }

        /* Glassmorphism Components */
        .glass {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .glass-dark {
            background: var(--dark-glass);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Navigation */
        .navbar {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            width: 90%;
            max-width: 1200px;
            border-radius: 20px;
            padding: 12px 24px;
            transition: all 0.3s ease;
            animation: slideDown 1s ease;
        }

        @keyframes slideDown {
            from {
                transform: translateX(-50%) translateY(-100px);
                opacity: 0;
            }

            to {
                transform: translateX(-50%) translateY(0);
                opacity: 1;
            }
        }

        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-logo .logo-image {
            height: auto;
            width: auto;
            max-width: 150px;
            object-fit: contain;
            transition: transform 0.3s ease, filter 0.3s ease;
        }

        .nav-logo .logo-image:hover {
            transform: scale(1.05);
            filter: brightness(1.1);
        }

        .nav-menu {
            display: flex;
            list-style: none;
            gap: 2rem;
        }

        .nav-menu a {
            color: var(--text-light);
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
            position: relative;
        }

        .nav-menu a::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 0;
            height: 2px;
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            transition: width 0.3s ease;
        }

        .nav-menu a:hover::after {
            width: 100%;
        }

        .nav-menu a:hover {
            color: white;
            transform: translateY(-2px);
        }

        /* Main Content Area */
        .main-container {
            padding: 120px 2rem 60px;
            min-height: 100vh;
        }

        .content-wrapper {
            max-width: 1400px;
            margin: 0 auto;
        }

        .section {
            border-radius: 30px;
            padding: 3rem;
            margin-bottom: 3rem;
            animation: fadeInUp 1s ease both;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .section h2 {
            font-size: 2.5rem;
            font-weight: 700;
            color: white;
            margin-bottom: 2rem;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        /* Control Elements */
        .controls {
            display: flex;
            gap: 2rem;
            margin-bottom: 3rem;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
            padding: 2rem;
            border-radius: 20px;
        }

        .search-bar {
            display: flex;
            gap: 1rem;
            flex: 1;
            min-width: 300px;
        }

        .search-input {
            flex: 1;
            padding: 16px 24px;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 50px;
            color: var(--text-light);
            font-family: 'Roboto Mono', monospace;
            font-size: 1rem;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(144, 242, 9, 0.2);
            background: rgba(255, 255, 255, 0.1);
        }

        .search-input::placeholder {
            color: var(--text-muted);
        }

        .filter-select {
            padding: 16px 24px;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 50px;
            color: var(--text-light);
            font-family: 'Roboto Mono', monospace;
            font-size: 1rem;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            transition: all 0.3s ease;
            min-width: 200px;
        }

        .filter-select:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(144, 242, 9, 0.2);
        }

        /* Buttons */
        .btn {
            padding: 16px 32px;
            border-radius: 50px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            font-family: 'Roboto Mono', monospace;
            font-size: 1rem;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            color: var(--light-gray);
            box-shadow: 0 10px 30px rgba(1, 62, 251, 0.4);
        }

        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .btn-primary:hover::before {
            left: 100%;
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(1, 62, 251, 0.5), 0 0 30px rgba(144, 242, 9, 0.3);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-light);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover {
            background: rgba(144, 242, 9, 0.1);
            border-color: var(--secondary-color);
            transform: translateY(-2px);
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 0.9rem;
            border-radius: 25px;
        }

        .btn-success {
            background: linear-gradient(45deg, #28a745, var(--secondary-color));
            color: white;
        }

        /* Repository Grid */
        .repos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        .repo-card {
            border-radius: 20px;
            padding: 2rem;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
        }

        .repo-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(144, 242, 9, 0.1), rgba(1, 62, 251, 0.1));
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .repo-card:hover::before {
            opacity: 0.7;
        }

        .repo-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 60px rgba(1, 62, 251, 0.2), 0 0 30px rgba(144, 242, 9, 0.1);
        }

        .repo-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1.5rem;
            position: relative;
            z-index: 2;
        }

        .repo-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: white;
            margin-bottom: 0.5rem;
        }

        .token-id {
            background: rgba(144, 242, 9, 0.2);
            color: var(--secondary-color);
            padding: 8px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            border: 1px solid rgba(144, 242, 9, 0.3);
            font-weight: 600;
        }

        .repo-info {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 1.5rem;
            position: relative;
            z-index: 2;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
        }

        .info-label {
            color: var(--text-muted);
            font-size: 0.9rem;
            font-weight: 500;
        }

        .info-value {
            color: var(--secondary-color);
            font-weight: 600;
        }

        .owner-address {
            font-family: 'Roboto Mono', monospace;
            background: rgba(0, 0, 0, 0.3);
            padding: 6px 12px;
            border-radius: 10px;
            font-size: 0.8rem;
            border: 1px solid rgba(144, 242, 9, 0.2);
        }

        .cid-hash {
            font-family: 'Roboto Mono', monospace;
            background: rgba(0, 0, 0, 0.3);
            padding: 6px 12px;
            border-radius: 10px;
            font-size: 0.8rem;
            word-break: break-all;
            border: 1px solid rgba(144, 242, 9, 0.2);
        }

        .repo-actions {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            position: relative;
            z-index: 2;
        }

        /* Loading and State Messages */
        .loading-state {
            text-align: center;
            padding: 4rem;
            color: var(--text-muted);
            border-radius: 20px;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 3px solid rgba(144, 242, 9, 0.3);
            border-top: 3px solid var(--secondary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 2rem;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .empty-state {
            text-align: center;
            padding: 4rem;
            color: var(--text-muted);
            border-radius: 20px;
        }

        .empty-state h3 {
            color: white;
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }

        .error-state {
            text-align: center;
            padding: 2rem;
            color: #ff4444;
            border: 2px solid rgba(255, 68, 68, 0.5);
            border-radius: 20px;
            background: rgba(255, 68, 68, 0.1);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
        }

        .error-state h3 {
            color: #ff6666;
            margin-bottom: 1rem;
        }

        /* Statistics */
        .stats-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
            padding: 2rem;
            border-radius: 20px;
        }

        .stat-item {
            text-align: center;
            padding: 1.5rem;
            border-radius: 15px;
            transition: all 0.3s ease;
        }

        .stat-item:hover {
            transform: translateY(-5px);
        }

        .stat-number {
            font-size: 3rem;
            font-weight: 700;
            color: var(--secondary-color);
            text-shadow: 0 0 20px rgba(144, 242, 9, 0.5);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: var(--text-muted);
            font-size: 1rem;
            font-weight: 500;
        }

        /* Modals */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            animation: modalFadeIn 0.3s ease;
        }

        @keyframes modalFadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .modal-content {
            background: var(--dark-glass);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            margin: 5% auto;
            padding: 3rem;
            border: 2px solid var(--glass-border);
            border-radius: 20px;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        /* Estilos para lista de commits - Tema oscuro moderno */
        .commits-list {
            max-height: 450px;
            overflow-y: auto;
            border: 2px solid var(--glass-border);
            border-radius: 20px;
            padding: 1.5rem;
            background: var(--dark-glass);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .commit-item {
            background: linear-gradient(145deg, rgba(0, 0, 0, 0.6), rgba(1, 17, 43, 0.4));
            border: 2px solid rgba(144, 242, 9, 0.2);
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            color: var(--text-light);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .commit-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(144, 242, 9, 0.05), rgba(1, 62, 251, 0.05));
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .commit-item:hover {
            border-color: rgba(144, 242, 9, 0.5);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(144, 242, 9, 0.2);
        }

        .commit-item:hover::before {
            opacity: 1;
        }

        .commit-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            position: relative;
            z-index: 2;
        }

        .commit-index {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 8px 14px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 0.9rem;
            box-shadow: 0 4px 15px rgba(1, 62, 251, 0.3);
            font-family: 'Roboto Mono', monospace;
        }

        .commit-status {
            padding: 8px 16px;
            border-radius: 25px;
            font-size: 0.8rem;
            font-weight: 700;
            text-transform: uppercase;
            font-family: 'Roboto Mono', monospace;
            border: 2px solid;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .commit-status.pending {
            background: linear-gradient(45deg, rgba(255, 193, 7, 0.2), rgba(255, 193, 7, 0.1));
            color: #ffc107;
            border-color: rgba(255, 193, 7, 0.5);
            box-shadow: 0 4px 15px rgba(255, 193, 7, 0.2);
        }

        .commit-status.approved {
            background: linear-gradient(45deg, rgba(40, 167, 69, 0.2), rgba(144, 242, 9, 0.1));
            color: var(--secondary-color);
            border-color: rgba(144, 242, 9, 0.5);
            box-shadow: 0 4px 15px rgba(144, 242, 9, 0.2);
        }

        .commit-status.rejected {
            background: linear-gradient(45deg, rgba(220, 53, 69, 0.2), rgba(220, 53, 69, 0.1));
            color: #dc3545;
            border-color: rgba(220, 53, 69, 0.5);
            box-shadow: 0 4px 15px rgba(220, 53, 69, 0.2);
        }

        .commit-info {
            margin-bottom: 1rem;
            position: relative;
            z-index: 2;
        }

        .commit-message {
            font-weight: 700;
            color: white;
            margin-bottom: 0.75rem;
            font-size: 1.1rem;
            line-height: 1.4;
        }

        .commit-details {
            font-size: 0.9rem;
            color: var(--text-muted);
            line-height: 1.5;
            font-family: 'Roboto Mono', monospace;
        }

        .commit-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: wrap;
            position: relative;
            z-index: 2;
        }

        .reward-input {
            min-width: 120px;
            padding: 10px 15px;
            border: 2px solid rgba(144, 242, 9, 0.3);
            border-radius: 15px;
            font-size: 0.9rem;
            background: rgba(0, 0, 0, 0.4);
            color: white;
            font-family: 'Roboto Mono', monospace;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .reward-input:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(144, 242, 9, 0.2);
            background: rgba(0, 0, 0, 0.6);
        }

        .reward-input::placeholder {
            color: var(--text-muted);
        }

        .loading-message {
            text-align: center;
            padding: 2rem;
            color: var(--text-muted);
            font-style: italic;
            background: rgba(144, 242, 9, 0.05);
            border-radius: 15px;
            border: 2px solid rgba(144, 242, 9, 0.2);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .no-commits-message {
            text-align: center;
            padding: 2.5rem;
            color: var(--text-muted);
            font-style: italic;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            border: 2px solid rgba(235, 235, 235, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .close {
            color: var(--text-muted);
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .close:hover {
            color: white;
            background: rgba(220, 53, 69, 0.2);
            border: 2px solid rgba(220, 53, 69, 0.5);
            transform: scale(1.1);
            box-shadow: 0 4px 15px rgba(220, 53, 69, 0.3);
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        @keyframes loading {
            0% {
                left: -100%;
            }

            100% {
                left: 100%;
            }
        }

        /* Deposit Modal Specific Styles */
        .deposit-modal .modal-content {
            max-width: 600px;
            background: linear-gradient(145deg, var(--dark-glass), rgba(1, 62, 251, 0.1));
            border: 2px solid rgba(144, 242, 9, 0.3);
            box-shadow: 0 25px 80px rgba(1, 62, 251, 0.4), 0 0 40px rgba(144, 242, 9, 0.2);
            animation: modalSlideIn 0.4s ease;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.9);
            }

            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .deposit-header {
            text-align: center;
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 2px solid rgba(144, 242, 9, 0.3);
        }

        .deposit-header h2 {
            background: linear-gradient(45deg, var(--secondary-color), white);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .deposit-subtitle {
            color: var(--text-muted);
            font-size: 1rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            color: var(--secondary-color);
            font-weight: 600;
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }

        .info-field {
            background: rgba(0, 0, 0, 0.4);
            border: 2px solid rgba(144, 242, 9, 0.3);
            border-radius: 15px;
            padding: 12px 16px;
            color: white;
            font-family: 'Roboto Mono', monospace;
            word-break: break-all;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .form-input {
            width: 100%;
            background: rgba(0, 0, 0, 0.4);
            border: 2px solid rgba(144, 242, 9, 0.3);
            border-radius: 15px;
            padding: 16px 20px;
            color: white;
            font-family: 'Roboto Mono', monospace;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 4px rgba(144, 242, 9, 0.2);
            background: rgba(0, 0, 0, 0.6);
        }

        .form-input::placeholder {
            color: var(--text-muted);
        }

        .form-hint {
            display: block;
            margin-top: 0.5rem;
            color: var(--text-muted);
            font-size: 0.9rem;
            font-style: italic;
        }

        .form-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 1px solid rgba(144, 242, 9, 0.2);
        }

        .deposit-amount-group {
            position: relative;
        }

        .eth-symbol {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--secondary-color);
            font-weight: bold;
            pointer-events: none;
        }

        .quick-amounts {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
            flex-wrap: wrap;
        }

        .quick-amount {
            background: rgba(144, 242, 9, 0.2);
            border: 1px solid rgba(144, 242, 9, 0.4);
            border-radius: 20px;
            padding: 4px 12px;
            color: var(--secondary-color);
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .quick-amount:hover {
            background: rgba(144, 242, 9, 0.4);
            transform: scale(1.05);
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 1rem;
            }

            .controls {
                flex-direction: column;
                align-items: stretch;
            }

            .search-bar {
                min-width: auto;
            }

            .repos-grid {
                grid-template-columns: 1fr;
            }

            .stats-bar {
                justify-content: center;
            }

            .form-actions {
                flex-direction: column;
            }

            .deposit-modal .modal-content {
                margin: 2% auto;
                width: 95%;
            }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .nav-menu {
                display: none;
            }

            .navbar {
                width: 95%;
                padding: 12px 20px;
            }

            .repos-grid {
                grid-template-columns: 1fr;
            }

            .stats-bar {
                grid-template-columns: 1fr;
            }

            .controls {
                flex-direction: column;
                align-items: stretch;
            }

            .search-bar {
                min-width: auto;
            }
        }
    </style>
</head>

<body>
    <div class="bg-animation">
        <div class="bg-cube"></div>
        <div class="bg-cube"></div>
        <div class="bg-cube"></div>
    </div>

    <!-- Navigation -->
    <nav class="navbar glass">
        <div class="nav-container">
            <div class="nav-logo">
                <img src="src/assets/BLANCO.png" alt="BlockHub Logo" class="logo-image">
            </div>
            <ul class="nav-menu">
                <li><a href="index.html">Inicio</a></li>
                <li><a href="conectar-wallet.html">Wallet</a></li>
                <li><a href="editor-archivos.html">Editor</a></li>
                <li><a href="colaboradores.html" style="color: var(--secondary-color);">Colaboradores</a></li>
            </ul>
        </div>
    </nav>

    <div class="main-container">
        <div class="content-wrapper">
            <!-- Estad√≠sticas -->
            <div class="section glass">
                <h2>üìä Estad√≠sticas de Repositorios</h2>
                <div class="stats-bar glass-dark">
                    <div class="stat-item glass">
                        <div id="totalRepos" class="stat-number">0</div>
                        <div class="stat-label">Total Repositorios</div>
                    </div>
                    <div class="stat-item glass">
                        <div id="uniqueOwners" class="stat-number">0</div>
                        <div class="stat-label">Propietarios √önicos</div>
                    </div>
                    <div class="stat-item glass">
                        <div id="myRepos" class="stat-number">0</div>
                        <div class="stat-label">Mis Repositorios</div>
                    </div>
                </div>
            </div>

            <!-- Controles -->
            <div class="section glass">
                <h2>üîç Explorar Repositorios</h2>
                <div class="controls glass-dark">
                    <div class="search-bar">
                        <input type="text" id="searchInput" class="search-input"
                            placeholder="Buscar por nombre de repositorio o direcci√≥n del propietario...">
                        <button class="btn btn-primary" onclick="searchRepositories()">
                            üîç Buscar
                        </button>
                    </div>
                    <select id="filterSelect" class="filter-select" onchange="filterRepositories()">
                        <option value="all">Todos los repositorios</option>
                        <option value="mine">Mis repositorios</option>
                        <option value="others">De otros propietarios</option>
                        <option value="recent">M√°s recientes</option>
                    </select>
                    <button class="btn btn-secondary" onclick="refreshRepositories()">
                        üîÑ Actualizar
                    </button>
                </div>

                <!-- Estado de carga -->
                <div id="loadingState" class="loading-state" style="display: none;">
                    <div class="loading-spinner"></div>
                    <p>Cargando repositorios desde blockchain...</p>
                </div>

                <!-- Estado de error -->
                <div id="errorState" class="error-state" style="display: none;">
                    <h3>‚ùå Error cargando repositorios</h3>
                    <p id="errorMessage"></p>
                    <button class="btn" onclick="refreshRepositories()">
                        üîÑ Reintentar
                    </button>
                </div>

                <!-- Estado vac√≠o -->
                <div id="emptyState" class="empty-state" style="display: none;">
                    <h3>üì≠ No hay repositorios</h3>
                    <p>No se encontraron repositorios que coincidan con los criterios de b√∫squeda.</p>
                    <button class="btn" onclick="goToEditor()">
                        üìù Crear primer repositorio
                    </button>
                </div>

                <!-- Grid de repositorios -->
                <div id="reposGrid" class="repos-grid">
                    <!-- Los repositorios se cargar√°n aqu√≠ din√°micamente -->
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para editar repositorio -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeEditModal()">&times;</span>
            <h2>üìù Colaborar en Repositorio</h2>
            <div id="editContent">
                <!-- Contenido del editor se cargar√° aqu√≠ -->
            </div>
        </div>
    </div>

    <!-- Scripts necesarios -->
    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <script src="pinata-config.js"></script>
    <script src="web3-contract-integration.js"></script>

    <script>
        // Variables globales - usando la misma l√≥gica del editor
        // window.blockHubWeb3 ya est√° disponible globalmente
        // window.pinataService ya est√° disponible globalmente desde pinata-config.js
        let allRepositories = [];
        let filteredRepositories = [];
        let currentAccount = null;
        let web3Connected = false;

        // Funciones de navegaci√≥n
        function handleBackToWallet() {
            try {
                window.location.href = 'conectar-wallet.html';
            } catch (error) {
                try {
                    window.location.href = './conectar-wallet.html';
                } catch (error2) {
                    window.location.href = 'index.html';
                }
            }
        }

        function goToEditor() {
            try {
                window.location.href = 'editor-archivos.html';
            } catch (error) {
                try {
                    window.location.href = './editor-archivos.html';
                } catch (error2) {
                    alert('‚ùå No se pudo navegar al editor');
                }
            }
        }

        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('üöÄ Inicializando p√°gina de colaboradores...');

            // Verificar servicios disponibles - misma l√≥gica del editor
            try {
                // Verificar que los servicios est√©n disponibles
                if (typeof window.blockHubWeb3 === 'undefined') {
                    throw new Error('window.blockHubWeb3 no est√° disponible. Verifica que web3-contract-integration.js se carg√≥ correctamente.');
                }
                if (typeof window.pinataService === 'undefined') {
                    throw new Error('window.pinataService no est√° disponible. Verifica que pinata-config.js se carg√≥ correctamente.');
                }

                console.log('‚úÖ window.blockHubWeb3 disponible');
                console.log('‚úÖ window.pinataService disponible');

                // Conectar autom√°ticamente si es posible
                await initializeConnection();

                // Cargar repositorios
                await loadRepositories();

                // Configurar b√∫squeda en tiempo real
                setupSearchHandlers();

            } catch (error) {
                console.error('‚ùå Error en inicializaci√≥n:', error);
                showError('Error inicializando la aplicaci√≥n: ' + error.message);
            }
        });

        // Inicializar conexi√≥n - simplificado para colaboradores
        async function initializeConnection() {
            try {
                console.log('üîç Verificando conexi√≥n Web3...');

                if (typeof window.ethereum === 'undefined') {
                    throw new Error('MetaMask no detectado');
                }

                // Verificar si ya hay cuentas conectadas
                const accounts = await window.ethereum.request({
                    method: 'eth_accounts'
                });

                if (accounts.length > 0) {
                    // Inicializar Web3 service
                    await window.blockHubWeb3.initializeWeb3();
                    web3Connected = true;

                    // Obtener info de cuenta
                    const accountInfo = window.blockHubWeb3.getAccountInfo();
                    currentAccount = accountInfo.account;

                    console.log('‚úÖ Conectado autom√°ticamente:', currentAccount);
                    console.log('üîó Estado: Web3 conectado desde p√°gina anterior');
                } else {
                    console.log('‚ö†Ô∏è No hay cuentas conectadas');
                    console.log('üí° Sugerencia: Ve a la p√°gina de Wallet para conectar MetaMask');
                }

                // Escuchar cambios de cuenta
                window.ethereum.on('accountsChanged', handleAccountsChanged);
                window.ethereum.on('chainChanged', handleChainChanged);

            } catch (error) {
                console.error('‚ùå Error verificando conexi√≥n:', error);
                console.log('‚ö†Ô∏è Para acceder a funcionalidades Web3, conecta tu wallet primero');
            }
        }

        // Cargar repositorios
        async function loadRepositories() {
            try {
                showLoading(true);
                hideError();
                hideEmpty();

                if (!web3Connected) {
                    throw new Error('Web3 no conectado');
                }

                console.log('üìã Llamando getAllRepos() sin par√°metros usando window.blockHubWeb3...');

                // Usar window.blockHubWeb3 directamente como en el editor
                let result;

                try {
                    // Verificar que el contrato est√© disponible
                    if (!window.blockHubWeb3.repoFactoryContract) {
                        throw new Error('Contrato RepoFactory no disponible');
                    }

                    console.log('üîç Debug del contrato:', {
                        contractAvailable: !!window.blockHubWeb3.repoFactoryContract,
                        contractAddress: window.blockHubWeb3.repoFactoryContract.address,
                        getAllReposAvailable: !!(window.blockHubWeb3.repoFactoryContract.getAllRepos),
                        isInitialized: !!window.blockHubWeb3.isInitialized,
                        currentAccount: currentAccount
                    });

                    // Verificar red y contrato
                    const network = await window.blockHubWeb3.web3.eth.net.getId();
                    console.log('üåê Red actual:', network);
                    console.log('üìç Direcci√≥n del contrato:', window.blockHubWeb3.repoFactoryContract.address);

                    // Verificar si el contrato existe en esta direcci√≥n
                    const code = await window.blockHubWeb3.web3.eth.getCode(window.blockHubWeb3.repoFactoryContract.address);
                    console.log('üîç C√≥digo del contrato:', code.length > 2 ? 'Existe' : 'No existe');

                    if (code === '0x') {
                        throw new Error(`No hay contrato desplegado en ${window.blockHubWeb3.repoFactoryContract.address} en la red ${network}`);
                    }

                    // Llamar directamente al contrato usando Ethers.js
                    if (window.blockHubWeb3.repoFactoryContract.getAllRepos) {
                        console.log('üì¶ Llamando contract.getAllRepos() directamente...');
                        result = await window.blockHubWeb3.repoFactoryContract.getAllRepos();
                        console.log('‚úÖ Resultado getAllRepos():', result);
                    } else {
                        throw new Error('Funci√≥n getAllRepos() no disponible en el contrato');
                    }
                } catch (contractError) {
                    console.error('‚ùå Error llamando contrato:', contractError);

                    // Informaci√≥n adicional para debugging
                    if (contractError.code === 'CALL_EXCEPTION') {
                        console.error('üîç Detalles del error CALL_EXCEPTION:');
                        console.error('  - Method:', contractError.method);
                        console.error('  - Data:', contractError.data);
                        console.error('  - Reason:', contractError.reason);
                        console.error('  - ErrorArgs:', contractError.errorArgs);

                        // Sugerir posibles causas
                        console.error('üîç Posibles causas:');
                        console.error('  1. Contrato no desplegado en esta red');
                        console.error('  2. Direcci√≥n del contrato incorrecta');
                        console.error('  3. Funci√≥n getAllRepos() no existe en el contrato');
                        console.error('  4. El contrato no tiene repositorios (puede ser normal)');
                    }

                    throw new Error(`Error del contrato: ${contractError.message}`);
                }

                // Verificar si el resultado es v√°lido
                if (!result) {
                    console.log('üì≠ No hay resultado del contrato');
                    allRepositories = [];
                } else if (!Array.isArray(result)) {
                    console.log('üì≠ Resultado no es array:', result);
                    allRepositories = [];
                } else if (result.length < 4) {
                    console.log('üì≠ Resultado incompleto:', result);
                    allRepositories = [];
                } else {
                    // Procesar resultado: [folderCIDs, tokens, owners, names]
                    const [folderCIDs, tokens, owners, names] = result;

                    console.log('üìä Datos del contrato:');
                    console.log('  folderCIDs:', folderCIDs);
                    console.log('  tokens:', tokens);
                    console.log('  owners:', owners);
                    console.log('  names:', names);

                    // Verificar si hay repositorios
                    if (!folderCIDs || folderCIDs.length === 0) {
                        console.log('üì≠ No hay repositorios en el contrato (esto es normal si no se han creado)');
                        allRepositories = [];
                    } else {
                        // Convertir a formato de repositorios
                        allRepositories = [];
                        for (let i = 0; i < folderCIDs.length; i++) {
                            allRepositories.push({
                                tokenId: tokens[i].toString(),
                                name: names[i],
                                cid: folderCIDs[i],
                                owner: owners[i],
                                index: i
                            });
                        }
                    }
                }

                filteredRepositories = [...allRepositories];

                console.log(`‚úÖ Procesados ${allRepositories.length} repositorios desde blockchain`);

                // Actualizar estad√≠sticas
                updateStats();

                // Renderizar repositorios
                renderRepositories();

                // Aplicar filtro actual
                filterRepositories();

            } catch (error) {
                console.error('‚ùå Error cargando repositorios:', error);
                showError(error.message);
            } finally {
                showLoading(false);
            }
        }

        // Actualizar estad√≠sticas
        function updateStats() {
            const totalRepos = allRepositories.length;
            const uniqueOwners = new Set(allRepositories.map(repo => repo.owner)).size;
            const myRepos = currentAccount ?
                allRepositories.filter(repo =>
                    repo.owner.toLowerCase() === currentAccount.toLowerCase()
                ).length : 0;

            document.getElementById('totalRepos').textContent = totalRepos;
            document.getElementById('uniqueOwners').textContent = uniqueOwners;
            document.getElementById('myRepos').textContent = myRepos;
        }

        // Renderizar repositorios
        function renderRepositories() {
            const grid = document.getElementById('reposGrid');

            if (filteredRepositories.length === 0) {
                showEmpty();
                return;
            }

            hideEmpty();

            grid.innerHTML = filteredRepositories.map(repo => `
                <div class="repo-card" data-token-id="${repo.tokenId}">
                    <div class="repo-header">
                        <div class="repo-title">${escapeHtml(repo.name)}</div>
                        <div class="token-id">#${repo.tokenId}</div>
                    </div>
                    
                    <div class="repo-info">
                        <div class="info-row">
                            <span class="info-label">Propietario:</span>
                            <span class="info-value owner-address" title="${repo.owner}">
                                ${repo.owner.substring(0, 6)}...${repo.owner.substring(38)}
                            </span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">CID:</span>
                            <span class="info-value cid-hash" title="${repo.cid}">
                                ${repo.cid.substring(0, 12)}...
                            </span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Es m√≠o:</span>
                            <span class="info-value">
                                ${isMyRepo(repo) ? '‚úÖ S√≠' : '‚ùå No'}
                            </span>
                        </div>
                    </div>
                    
                    <div class="repo-actions">
                        <button class="btn btn-small" onclick="viewRepository('${repo.tokenId}', '${repo.cid}', '${escapeHtml(repo.name)}')">
                            üëÅÔ∏è Ver Archivos
                        </button>
                                                 <button class="btn btn-small btn-secondary" onclick="openInEditor('${repo.tokenId}', '${repo.cid}', '${escapeHtml(repo.name)}')">
                             üìù Abrir en Editor
                         </button>
                         ${isOwner(repo.owner) ? `
                         <button class="btn btn-small btn-primary" onclick="showDepositModal('${repo.tokenId}', '${escapeHtml(repo.name)}')">
                             üí∞ Depositar ETH
                         </button>
                         <button class="btn btn-small btn-success" onclick="showCommitsModal('${repo.tokenId}', '${escapeHtml(repo.name)}')">
                             ‚úÖ Aprobar Commits
                         </button>` : ''}
                    </div>
                </div>
            `).join('');
        }

        // Filtrar repositorios
        function filterRepositories() {
            const filter = document.getElementById('filterSelect').value;
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();

            let filtered = [...allRepositories];

            // Aplicar filtro por tipo
            switch (filter) {
                case 'mine':
                    filtered = filtered.filter(repo => isMyRepo(repo));
                    break;
                case 'others':
                    filtered = filtered.filter(repo => !isMyRepo(repo));
                    break;
                case 'recent':
                    filtered = filtered.sort((a, b) => b.tokenId - a.tokenId);
                    break;
            }

            // Aplicar filtro de b√∫squeda
            if (searchTerm) {
                filtered = filtered.filter(repo =>
                    repo.name.toLowerCase().includes(searchTerm) ||
                    repo.owner.toLowerCase().includes(searchTerm) ||
                    repo.cid.toLowerCase().includes(searchTerm)
                );
            }

            filteredRepositories = filtered;
            renderRepositories();
        }

        // Buscar repositorios
        function searchRepositories() {
            filterRepositories();
        }

        // Configurar manejadores de b√∫squeda
        function setupSearchHandlers() {
            const searchInput = document.getElementById('searchInput');

            // B√∫squeda en tiempo real con debounce
            let searchTimeout;
            searchInput.addEventListener('input', () => {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    filterRepositories();
                }, 300);
            });

            // B√∫squeda al presionar Enter
            searchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    filterRepositories();
                }
            });
        }

        // Obtener el CID del √∫ltimo commit aprobado
        async function getLatestApprovedCommitCid(tokenId, originalCid) {
            try {
                console.log(`üîç Buscando √∫ltimo commit aprobado para repositorio ${tokenId}...`);

                // Verificar conexi√≥n
                if (!window.blockHubWeb3 || !window.blockHubWeb3.repoFactoryContract) {
                    console.log('‚ö†Ô∏è Web3 no conectado, usando CID original');
                    return originalCid;
                }

                // Obtener todos los commits del repositorio
                const commitsData = await window.blockHubWeb3.repoFactoryContract.retrieveCommits(tokenId);
                const [messages, timestamps, committers, statuses, commitCIDs] = commitsData;

                if (!statuses || statuses.length === 0) {
                    console.log('üì≠ No hay commits, usando CID original');
                    return originalCid;
                }

                // Buscar el √∫ltimo commit aprobado (status = 1) con su CID espec√≠fico
                let latestApprovedCid = null;
                let latestApprovedTimestamp = 0;

                for (let i = 0; i < statuses.length; i++) {
                    const status = parseInt(statuses[i].toString());
                    const timestamp = parseInt(timestamps[i].toString());
                    const cid = commitCIDs && commitCIDs[i] ? commitCIDs[i] : null;

                    // Si es aprobado (status = 1), m√°s reciente, y tiene CID
                    if (status === 1 && timestamp > latestApprovedTimestamp && cid) {
                        latestApprovedCid = cid;
                        latestApprovedTimestamp = timestamp;
                    }
                }

                if (latestApprovedCid) {
                    console.log(`‚úÖ √öltimo commit aprobado encontrado: ${latestApprovedCid}`);
                    console.log(`üìÖ Fecha: ${new Date(latestApprovedTimestamp * 1000).toLocaleString()}`);
                    return latestApprovedCid;
                } else {
                    console.log('üì≠ No hay commits aprobados con CID, usando CID original');
                    return originalCid;
                }

            } catch (error) {
                console.error('‚ùå Error obteniendo √∫ltimo commit:', error);
                console.log('‚ö†Ô∏è Fallback: usando CID original');
                return originalCid;
            }
        }

        // Ver repositorio
        async function viewRepository(tokenId, originalCid, name) {
            try {
                console.log(`üëÅÔ∏è Viendo repositorio: ${name} (${tokenId})`);

                showLoading(true, 'Obteniendo √∫ltimo commit...');

                // 1. Obtener el CID del √∫ltimo commit aprobado
                const latestCid = await getLatestApprovedCommitCid(tokenId, originalCid);

                showLoading(true, 'Cargando archivos desde IPFS...');

                // 2. Cargar archivos desde IPFS usando el CID m√°s reciente
                const files = await window.pinataService.loadFromIPFS(latestCid);

                if (files && files.length > 0) {
                    // Crear una nueva ventana o modal para mostrar archivos
                    showFilesModal(name, files, tokenId, latestCid);
                } else {
                    alert('‚ùå No se pudieron cargar los archivos del repositorio');
                }

            } catch (error) {
                console.error('‚ùå Error viendo repositorio:', error);
                alert('Error cargando repositorio: ' + error.message);
            } finally {
                showLoading(false);
            }
        }

        // Colaborar en repositorio
        async function collaborateInRepo(tokenId, originalCid, name) {
            try {
                console.log(`ü§ù Iniciando colaboraci√≥n en: ${name} (${tokenId})`);

                // Verificar que tenemos conexi√≥n
                if (!currentAccount) {
                    alert('‚ùå Necesitas conectar tu wallet para colaborar');
                    return;
                }

                // Obtener el CID del √∫ltimo commit aprobado
                showLoading(true, 'Obteniendo √∫ltima versi√≥n...');
                const latestCid = await getLatestApprovedCommitCid(tokenId, originalCid);

                // Cargar archivos del repositorio
                showLoading(true, 'Preparando entorno de colaboraci√≥n...');

                const files = await window.pinataService.loadFromIPFS(latestCid);

                if (files && files.length > 0) {
                    // Abrir editor de colaboraci√≥n usando el CID m√°s reciente
                    openCollaborationEditor(tokenId, latestCid, name, files);
                } else {
                    alert('‚ùå No se pudieron cargar los archivos para colaborar');
                }

            } catch (error) {
                console.error('‚ùå Error iniciando colaboraci√≥n:', error);
                alert('Error preparando colaboraci√≥n: ' + error.message);
            } finally {
                showLoading(false);
            }
        }

        // Abrir editor de colaboraci√≥n
        function openCollaborationEditor(tokenId, originalCid, name, files) {
            const modal = document.getElementById('editModal');
            const content = document.getElementById('editContent');

            // Crear interfaz de edici√≥n
            content.innerHTML = `
                <div style="margin-bottom: 1rem;">
                    <h3 style="color: #00ff00;">üìù Editando: ${escapeHtml(name)}</h3>
                    <p style="color: #888;">Token ID: ${tokenId} | CID Original: ${originalCid}</p>
                </div>
                
                <div style="margin-bottom: 1rem;">
                    <label style="display: block; margin-bottom: 5px; color: #00ff00;">
                        üìÅ Seleccionar archivo para editar:
                    </label>
                    <select id="fileSelect" style="width: 100%; padding: 10px; background: #000; color: #00ff00; border: 1px solid #333; border-radius: 5px;">
                        ${files.map((file, index) =>
                `<option value="${index}">${file.name} (${file.size} bytes)</option>`
            ).join('')}
                    </select>
                </div>
                
                <div style="margin-bottom: 1rem;">
                    <label style="display: block; margin-bottom: 5px; color: #00ff00;">
                        üìù Contenido del archivo:
                    </label>
                    <textarea 
                        id="fileContent" 
                        style="width: 100%; height: 300px; padding: 10px; background: #000; color: #00ff00; border: 1px solid #333; border-radius: 5px; font-family: 'Courier New', monospace; resize: vertical;"
                        placeholder="Cargando contenido del archivo..."
                    ></textarea>
                </div>
                
                <div style="margin-bottom: 1rem;">
                    <label style="display: block; margin-bottom: 5px; color: #00ff00;">
                        üí¨ Mensaje del commit:
                    </label>
                    <input 
                        type="text" 
                        id="commitMessage" 
                        style="width: 100%; padding: 10px; background: #000; color: #00ff00; border: 1px solid #333; border-radius: 5px;"
                        placeholder="Describe los cambios realizados..."
                    >
                </div>
                
                <div style="display: flex; gap: 10px; justify-content: flex-end;">
                    <button class="btn btn-secondary" onclick="closeEditModal()">
                        ‚ùå Cancelar
                    </button>
                    <button class="btn" onclick="submitCollaboration('${tokenId}', '${originalCid}', '${escapeHtml(name)}')">
                        üöÄ Enviar Commit
                    </button>
                </div>
                
                <div id="collaborationStatus" style="margin-top: 1rem; padding: 10px; border-radius: 5px; display: none;">
                </div>
            `;

            // Cargar contenido del primer archivo
            loadFileContent(files, 0);

            // Configurar cambio de archivo
            document.getElementById('fileSelect').addEventListener('change', (e) => {
                loadFileContent(files, parseInt(e.target.value));
            });

            modal.style.display = 'block';
        }

        // Cargar contenido de archivo
        async function loadFileContent(files, index) {
            try {
                const file = files[index];
                const textarea = document.getElementById('fileContent');

                textarea.value = 'Cargando...';

                if (file.content) {
                    textarea.value = file.content;
                } else {
                    textarea.value = '// Archivo binario o contenido no disponible\n// Archivo: ' + file.name;
                }

            } catch (error) {
                console.error('‚ùå Error cargando archivo:', error);
                document.getElementById('fileContent').value = '// Error cargando archivo: ' + error.message;
            }
        }

        // Enviar colaboraci√≥n
        async function submitCollaboration(tokenId, originalCid, name) {
            try {
                const commitMessage = document.getElementById('commitMessage').value.trim();
                const fileContent = document.getElementById('fileContent').value;
                const fileSelect = document.getElementById('fileSelect');
                const fileIndex = parseInt(fileSelect.value);
                const fileName = fileSelect.options[fileSelect.selectedIndex].text.split(' (')[0];

                if (!commitMessage) {
                    alert('‚ùå Debes proporcionar un mensaje de commit');
                    return;
                }

                const statusDiv = document.getElementById('collaborationStatus');
                statusDiv.style.display = 'block';
                statusDiv.style.background = 'rgba(0, 255, 0, 0.1)';
                statusDiv.style.color = '#00ff00';
                statusDiv.innerHTML = '‚è≥ Procesando colaboraci√≥n...';

                // 1. Crear nuevo archivo con cambios
                console.log('üìù Subiendo archivo modificado a IPFS...');
                const fileBlob = new Blob([fileContent], { type: 'text/plain' });
                const file = new File([fileBlob], fileName, { type: 'text/plain' });

                statusDiv.innerHTML = 'üì§ Subiendo archivo a IPFS...';
                const uploadResult = await window.pinataService.uploadFile(file);

                if (!uploadResult.success) {
                    throw new Error('Error subiendo archivo: ' + uploadResult.error);
                }

                const newCid = uploadResult.hash;
                console.log('‚úÖ Archivo subido con CID:', newCid);

                // 2. Procesar commit en blockchain
                statusDiv.innerHTML = '‚õìÔ∏è Enviando commit a blockchain...';
                console.log(`‚õìÔ∏è Procesando commit: processNewCommit(${tokenId}, "${commitMessage}", "${newCid}")`);

                // Llamar directamente al contrato usando Ethers.js
                let commitResult;

                try {
                    // Usar window.blockHubWeb3 directamente como en el editor
                    if (!window.blockHubWeb3.repoFactoryContract) {
                        throw new Error('Contrato RepoFactory no disponible');
                    }

                    if (window.blockHubWeb3.repoFactoryContract.processNewCommit) {
                        console.log('üì¶ Llamando contract.processNewCommit() directamente...');
                        const tx = await window.blockHubWeb3.repoFactoryContract.processNewCommit(tokenId, commitMessage, newCid);
                        console.log('‚è≥ Transacci√≥n enviada:', tx.hash);

                        const receipt = await tx.wait();
                        console.log('‚úÖ Transacci√≥n confirmada:', receipt);

                        commitResult = {
                            success: true,
                            transactionHash: receipt.transactionHash,
                            blockNumber: receipt.blockNumber,
                            gasUsed: receipt.gasUsed.toString(),
                            tokenId: tokenId,
                            message: commitMessage,
                            newCid: newCid
                        };
                    } else {
                        throw new Error('Funci√≥n processNewCommit() no disponible en el contrato');
                    }
                } catch (contractError) {
                    console.error('‚ùå Error en processNewCommit:', contractError);
                    throw new Error(`Error del contrato: ${contractError.message}`);
                }

                if (!commitResult || !commitResult.success) {
                    throw new Error('No se pudo procesar el commit');
                }

                console.log('üéâ ¬°Commit procesado exitosamente!', commitResult);

                statusDiv.style.background = 'rgba(0, 255, 0, 0.2)';
                statusDiv.innerHTML = `
                    üéâ ¬°Commit enviado exitosamente!<br>
                    üìÑ TX: ${commitResult.transactionHash}<br>
                    üîó Nuevo CID: ${newCid}<br>
                    ‚õΩ Gas usado: ${commitResult.gasUsed}
                `;

                // 3. Actualizar lista de repositorios
                setTimeout(() => {
                    closeEditModal();
                    refreshRepositories();
                }, 3000);

            } catch (error) {
                console.error('‚ùå Error en colaboraci√≥n:', error);
                const statusDiv = document.getElementById('collaborationStatus');
                statusDiv.style.display = 'block';
                statusDiv.style.background = 'rgba(255, 68, 68, 0.2)';
                statusDiv.style.color = '#ff4444';
                statusDiv.innerHTML = '‚ùå Error: ' + error.message;
            }
        }

        // Mostrar modal de archivos
        function showFilesModal(name, files, tokenId, cid) {
            const modal = document.getElementById('editModal');
            const content = document.getElementById('editContent');

            content.innerHTML = `
                <div style="margin-bottom: 1rem;">
                    <h3 style="color: #00ff00;">üìÅ Archivos de: ${escapeHtml(name)}</h3>
                    <p style="color: #888;">Token ID: ${tokenId} | CID: ${cid}</p>
                </div>
                
                <div style="max-height: 400px; overflow-y: auto;">
                    ${files.map((file, index) => `
                        <div style="background: rgba(0, 0, 0, 0.5); padding: 1rem; margin-bottom: 1rem; border-radius: 5px; border: 1px solid #333;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                <strong style="color: #00ff00;">${file.name}</strong>
                                <span style="color: #888; font-size: 0.9rem;">${file.size} bytes</span>
                            </div>
                            <div style="background: #000; padding: 10px; border-radius: 3px; font-family: monospace; font-size: 0.9rem; max-height: 200px; overflow-y: auto;">
                                <pre style="margin: 0; white-space: pre-wrap; color: #00ff00;">${escapeHtml(file.content || '// Archivo binario o contenido no disponible')}</pre>
                            </div>
                        </div>
                    `).join('')}
                </div>
                
                <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 1rem;">
                    <button class="btn btn-secondary" onclick="closeEditModal()">
                        ‚ùå Cerrar
                    </button>
                    <button class="btn" onclick="closeEditModal(); collaborateInRepo('${tokenId}', '${cid}', '${escapeHtml(name)}')">
                        ü§ù Colaborar
                    </button>
                </div>
            `;

            modal.style.display = 'block';
        }

        // Cerrar modal
        function closeEditModal() {
            document.getElementById('editModal').style.display = 'none';
        }

        // Refrescar repositorios
        async function refreshRepositories() {
            await loadRepositories();
        }

        // Utilidades
        function isMyRepo(repo) {
            return currentAccount && repo.owner.toLowerCase() === currentAccount.toLowerCase();
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Verificar si el usuario actual es el due√±o del repositorio
        function isOwner(repoOwnerAddress) {
            if (!window.blockHubWeb3) {
                return false;
            }

            const accountInfo = window.blockHubWeb3.getAccountInfo();
            if (!accountInfo || !accountInfo.account) {
                return false;
            }

            // Comparar direcciones (case-insensitive)
            const currentAccount = accountInfo.account.toLowerCase();
            const repoOwner = repoOwnerAddress.toLowerCase();

            console.log(`üîç Verificando ownership: ${currentAccount} === ${repoOwner} ? ${currentAccount === repoOwner}`);

            return currentAccount === repoOwner;
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert('‚úÖ CID copiado al portapapeles');
            }).catch(() => {
                alert('‚ùå Error copiando al portapapeles');
            });
        }

        // Abrir repositorio en editor para hacer commit
        async function openInEditor(tokenId, originalCid, name) {
            try {
                console.log(`üìù Abriendo en editor: ${name} (Token: ${tokenId})`);

                // Buscar informaci√≥n del repositorio para obtener el owner
                const repo = allRepositories.find(r => r.tokenId === tokenId);
                const owner = repo ? repo.owner : '';

                console.log(`üë§ Owner encontrado: ${owner}`);
                console.log(`üìä Repositorio encontrado:`, repo);

                // Obtener el CID del √∫ltimo commit aprobado
                showStatus('üîç Obteniendo √∫ltimo commit...', 'info');
                const latestCid = await getLatestApprovedCommitCid(tokenId, originalCid);

                console.log(`üìÅ CID original: ${originalCid}`);
                console.log(`üîÑ CID m√°s reciente: ${latestCid}`);

                // Crear URL con par√°metros para el editor usando el CID m√°s reciente
                const editorUrl = new URL('editor-archivos.html', window.location.origin);
                editorUrl.searchParams.set('mode', 'commit');
                editorUrl.searchParams.set('tokenId', tokenId);
                editorUrl.searchParams.set('cid', latestCid);  // ‚úÖ Usar CID m√°s reciente
                editorUrl.searchParams.set('repoName', name);
                editorUrl.searchParams.set('owner', owner);

                console.log('üîó Redirigiendo a:', editorUrl.toString());

                window.location.href = editorUrl.toString();

            } catch (error) {
                console.error('‚ùå Error abriendo en editor:', error);
                alert('‚ùå Error abriendo el editor: ' + error.message);
            }
        }

        function updateWalletStatus(text, status) {
            // En colaboradores.html no tenemos elemento walletStatus espec√≠fico
            // Solo mostramos el estado en consola y opcionalmente en el √°rea de estad√≠sticas
            console.log(`üîó Estado Wallet: ${text} (${status})`);
        }

        // Funci√≥n helper para mostrar status temporal
        function showStatus(message, type = 'info') {
            const statusTypes = {
                'info': 'üìå',
                'success': '‚úÖ',
                'warning': '‚ö†Ô∏è',
                'error': '‚ùå'
            };

            const icon = statusTypes[type] || 'üìå';
            console.log(`${icon} ${message}`);

            // Opcional: mostrar en UI si hay un elemento disponible
            const statusEl = document.getElementById('searchStatus');
            if (statusEl) {
                statusEl.textContent = `${icon} ${message}`;
                statusEl.className = `status-${type}`;
                setTimeout(() => {
                    statusEl.textContent = '';
                }, 3000);
            }

            // Opcional: actualizar alg√∫n indicador visual si es necesario
            // Pero por ahora solo logging ya que esta p√°gina se enfoca en los repositorios
        }

        function showLoading(show, message = 'Cargando...') {
            const loadingState = document.getElementById('loadingState');
            if (loadingState) {
                if (show) {
                    loadingState.style.display = 'block';
                    const messageEl = loadingState.querySelector('p');
                    if (messageEl) {
                        messageEl.textContent = message;
                    }
                } else {
                    loadingState.style.display = 'none';
                }
            }
        }

        function showError(message) {
            const errorState = document.getElementById('errorState');
            const errorMessage = document.getElementById('errorMessage');
            errorMessage.textContent = message;
            errorState.style.display = 'block';
        }

        function hideError() {
            document.getElementById('errorState').style.display = 'none';
        }

        function showEmpty() {
            document.getElementById('emptyState').style.display = 'block';
        }

        function hideEmpty() {
            document.getElementById('emptyState').style.display = 'none';
        }

        // Manejadores de eventos
        function handleAccountsChanged(accounts) {
            if (accounts.length === 0) {
                currentAccount = null;
                web3Connected = false;
                console.log('‚ùå Wallet desconectado');
            } else {
                currentAccount = accounts[0];
                web3Connected = true;
                console.log('‚úÖ Cuenta cambiada:', `${currentAccount.substring(0, 6)}...${currentAccount.substring(38)}`);

                // Recargar repositorios para actualizar "Mis repositorios"
                updateStats();
                filterRepositories();
            }
        }

        function handleChainChanged(chainId) {
            console.log('üîÑ Red cambiada:', chainId);
            // Recargar la p√°gina para reconectar
            window.location.reload();
        }



        // Funci√≥n de debug para la consola
        window.debugContract = async function () {
            console.log('üîç === DEBUG CONTRATO ===');

            try {
                console.log('üìç Direcci√≥n del contrato:', window.blockHubWeb3.repoFactoryContract.address);

                const network = await window.blockHubWeb3.web3.eth.net.getId();
                console.log('üåê Red actual:', network);

                const code = await window.blockHubWeb3.web3.eth.getCode(window.blockHubWeb3.repoFactoryContract.address);
                console.log('üîç C√≥digo del contrato:', code.length > 2 ? 'Existe ‚úÖ' : 'No existe ‚ùå');

                if (code === '0x') {
                    console.error('‚ùå NO HAY CONTRATO DESPLEGADO EN ESTA DIRECCI√ìN');
                    return false;
                }

                console.log('üìã Intentando llamar getAllRepos()...');
                const result = await window.blockHubWeb3.repoFactoryContract.getAllRepos();
                console.log('‚úÖ Resultado getAllRepos():', result);

                return true;
            } catch (error) {
                console.error('‚ùå Error en debug:', error);
                return false;
            }
        };

        // Cerrar modal al hacer clic fuera
        window.onclick = function (event) {
            const modal = document.getElementById('editModal');
            if (event.target === modal) {
                closeEditModal();
            }
        }

        // === FUNCIONES DE DEP√ìSITO ===

        let currentDepositTokenId = null;

        // Mostrar modal de dep√≥sito
        function showDepositModal(tokenId, repoName) {
            console.log(`üí∞ Abriendo modal de dep√≥sito para: ${repoName} (Token: ${tokenId})`);

            currentDepositTokenId = tokenId;

            // Actualizar informaci√≥n en el modal
            document.getElementById('depositRepoName').textContent = repoName;
            document.getElementById('depositTokenId').textContent = tokenId;

            // Mostrar cuenta actual
            const accountInfo = window.blockHubWeb3?.getAccountInfo();
            if (accountInfo && accountInfo.account) {
                document.getElementById('depositAccount').textContent = accountInfo.account;
            } else {
                document.getElementById('depositAccount').textContent = 'No conectado';
            }

            // Limpiar formulario
            document.getElementById('ethAmount').value = '';
            const statusDiv = document.getElementById('depositStatus');
            statusDiv.style.display = 'none';

            // Mostrar modal
            document.getElementById('depositModal').style.display = 'block';
        }

        // Cerrar modal de dep√≥sito
        function closeDepositModal() {
            document.getElementById('depositModal').style.display = 'none';
            currentDepositTokenId = null;
        }

        // Funci√≥n para establecer cantidad r√°pida
        function setQuickAmount(amount) {
            document.getElementById('ethAmount').value = amount;
            // Agregar peque√±a animaci√≥n visual
            const input = document.getElementById('ethAmount');
            input.style.borderColor = 'var(--secondary-color)';
            input.style.boxShadow = '0 0 0 4px rgba(144, 242, 9, 0.3)';
            setTimeout(() => {
                input.style.borderColor = 'rgba(144, 242, 9, 0.3)';
                input.style.boxShadow = 'none';
            }, 1000);
        }

        // Ejecutar dep√≥sito
        async function executeDeposit() {
            try {
                const ethAmount = document.getElementById('ethAmount').value;
                const statusDiv = document.getElementById('depositStatus');
                const depositBtn = document.getElementById('depositBtn');

                // Validaciones
                if (!currentDepositTokenId) {
                    throw new Error('Token ID no v√°lido');
                }

                if (!ethAmount || parseFloat(ethAmount) <= 0) {
                    throw new Error('Cantidad de ETH debe ser mayor a 0');
                }

                if (parseFloat(ethAmount) < 0.0001) {
                    throw new Error('Cantidad m√≠nima: 0.0001 ETH');
                }

                // Verificar conexi√≥n
                if (!window.blockHubWeb3 || !window.blockHubWeb3.repoFactoryContract) {
                    throw new Error('Web3 no conectado o contrato no disponible');
                }

                console.log(`üí∞ Iniciando dep√≥sito: ${ethAmount} ETH al repositorio ${currentDepositTokenId}`);

                // Deshabilitar bot√≥n y mostrar estado
                depositBtn.disabled = true;
                depositBtn.innerHTML = '‚è≥ Preparando...';
                statusDiv.textContent = 'üí∞ Verificando informaci√≥n del dep√≥sito...';
                statusDiv.className = 'status-message status-info';
                statusDiv.style.display = 'block';

                // Llamar funci√≥n de dep√≥sito con manejo de errores mejorado
                const weiAmount = window.ethers.utils.parseEther(ethAmount);
                console.log(`üí∞ Enviando ${ethAmount} ETH (${weiAmount.toString()} Wei)`);

                let tx;
                let retryCount = 0;
                const maxRetries = 3;

                while (retryCount < maxRetries) {
                    try {
                        depositBtn.innerHTML = retryCount > 0 ?
                            `üîÑ Reintentando... (${retryCount + 1}/${maxRetries})` :
                            'üöÄ Enviando...';
                        statusDiv.textContent = retryCount > 0 ?
                            `üîÑ Reintentando transacci√≥n... (${retryCount + 1}/${maxRetries})` :
                            'üì§ Enviando transacci√≥n a la blockchain...';

                        tx = await window.blockHubWeb3.repoFactoryContract.depositToRepo(
                            currentDepositTokenId,
                            {
                                value: weiAmount,
                                gasLimit: 100000  // Gas l√≠mite espec√≠fico para dep√≥sitos
                            }
                        );

                        console.log('‚è≥ Transacci√≥n enviada:', tx.hash);
                        break; // Salir del loop si la transacci√≥n fue exitosa

                    } catch (txError) {
                        retryCount++;
                        console.warn(`‚ö†Ô∏è Intento ${retryCount} de dep√≥sito fall√≥:`, txError.message);

                        if (retryCount >= maxRetries) {
                            throw txError; // Lanzar el error despu√©s de todos los intentos
                        }

                        // Esperar antes del siguiente intento
                        await new Promise(resolve => setTimeout(resolve, 2000));
                    }
                }

                depositBtn.innerHTML = '‚è≥ Confirmando...';
                statusDiv.textContent = `‚è≥ Esperando confirmaci√≥n... TX: ${tx.hash.substring(0, 10)}...`;

                const receipt = await tx.wait();
                console.log('‚úÖ Dep√≥sito confirmado:', receipt);

                // Buscar evento depositedETH
                const depositEvent = receipt.events?.find(e => e.event === 'depositedETH');
                if (depositEvent) {
                    const [tokenId, depositor, amount] = depositEvent.args;
                    console.log('üéâ Evento depositedETH:', {
                        tokenId: tokenId.toString(),
                        depositor: depositor,
                        amount: window.ethers.utils.formatEther(amount) + ' ETH'
                    });
                }

                depositBtn.innerHTML = 'üéâ ¬°Exitoso!';
                statusDiv.textContent = `üéâ ¬°Dep√≥sito de ${ethAmount} ETH completado exitosamente!`;
                statusDiv.className = 'status-message status-success';

                // Resetear formulario despu√©s de un tiempo
                setTimeout(() => {
                    closeDepositModal();
                    // Opcional: recargar lista de repositorios para mostrar balance actualizado
                    loadRepositories();
                }, 3000);

            } catch (error) {
                console.error('‚ùå Error en dep√≥sito:', error);

                const statusDiv = document.getElementById('depositStatus');
                const depositBtn = document.getElementById('depositBtn');

                // Mensajes de error m√°s espec√≠ficos y √∫tiles
                let errorMessage = 'Error desconocido';

                if (error.code === -32080) {
                    errorMessage = 'üåê Error de conectividad RPC. Verifica tu conexi√≥n de red e intenta nuevamente. Ejecuta showRPCHelp() en consola para m√°s ayuda.';
                } else if (error.code === 4001) {
                    errorMessage = '‚ùå Transacci√≥n cancelada por el usuario.';
                } else if (error.message?.includes('insufficient funds')) {
                    errorMessage = 'üí∞ Fondos insuficientes. Verifica que tienes suficiente ETH para el dep√≥sito + gas.';
                } else if (error.message?.includes('gas')) {
                    errorMessage = '‚õΩ Error de gas. La transacci√≥n requiere m√°s gas del estimado.';
                } else if (error.message?.includes('nonce')) {
                    errorMessage = 'üîÑ Error de nonce. Intenta resetear tu cuenta MetaMask en Configuraci√≥n > Avanzado > Resetear Cuenta.';
                } else if (error.message?.includes('reverted')) {
                    errorMessage = '‚ö†Ô∏è La transacci√≥n fue revertida. Verifica que tienes permisos para depositar.';
                } else {
                    errorMessage = `‚ùå ${error.message || 'Error en la transacci√≥n de dep√≥sito'}`;
                }

                statusDiv.textContent = errorMessage;
                statusDiv.className = 'status-message status-error';
                statusDiv.style.display = 'block';

                // Rehabilitar bot√≥n
                depositBtn.disabled = false;
                depositBtn.innerHTML = 'üí∞ Depositar ETH';

                // Agregar bot√≥n de reintento para errores de conectividad
                if (error.code === -32080) {
                    const retryBtn = document.createElement('button');
                    retryBtn.className = 'btn btn-small btn-secondary';
                    retryBtn.style.marginTop = '1rem';
                    retryBtn.innerHTML = 'üîÑ Reintentar Dep√≥sito';
                    retryBtn.onclick = () => {
                        retryBtn.remove();
                        executeDeposit();
                    };
                    statusDiv.appendChild(retryBtn);
                }
            }
        }

        // === FUNCIONES DE APROBACI√ìN DE COMMITS ===

        let currentCommitsTokenId = null;

        // Mostrar modal de commits
        async function showCommitsModal(tokenId, repoName) {
            console.log(`‚úÖ Abriendo modal de commits para: ${repoName} (Token: ${tokenId})`);

            currentCommitsTokenId = tokenId;

            // Actualizar informaci√≥n en el modal
            document.getElementById('commitsRepoName').textContent = repoName;
            document.getElementById('commitsTokenId').textContent = tokenId;

            // Mostrar cuenta actual
            const accountInfo = window.blockHubWeb3?.getAccountInfo();
            if (accountInfo && accountInfo.account) {
                document.getElementById('commitsAccount').textContent = accountInfo.account;
            } else {
                document.getElementById('commitsAccount').textContent = 'No conectado';
            }

            // Limpiar estado
            const statusDiv = document.getElementById('commitsStatus');
            statusDiv.style.display = 'none';

            // Mostrar modal y cargar commits
            document.getElementById('commitsModal').style.display = 'block';

            // Cargar lista de commits
            await loadCommitsList(tokenId);
        }

        // Cerrar modal de commits
        function closeCommitsModal() {
            document.getElementById('commitsModal').style.display = 'none';
            currentCommitsTokenId = null;
        }

        // Cargar lista de commits del repositorio
        async function loadCommitsList(tokenId) {
            const commitsList = document.getElementById('commitsList');
            const statusDiv = document.getElementById('commitsStatus');

            try {
                commitsList.innerHTML = '<div class="loading-message">üîÑ Cargando commits...</div>';

                console.log(`üìã Cargando commits para repositorio ${tokenId}...`);

                // Verificar conexi√≥n
                if (!window.blockHubWeb3 || !window.blockHubWeb3.repoFactoryContract) {
                    throw new Error('Web3 no conectado o contrato no disponible');
                }

                // Llamar retrieveCommits del contrato
                console.log('üìû Llamando retrieveCommits del contrato...');
                const commitsData = await window.blockHubWeb3.repoFactoryContract.retrieveCommits(tokenId);
                console.log('üì• Datos de commits recibidos (RAW):', commitsData);
                console.log('üìä Tipo de datos:', typeof commitsData);
                console.log('üìè Longitud del resultado:', commitsData.length);

                // Debug detallado de cada elemento
                if (Array.isArray(commitsData)) {
                    commitsData.forEach((item, index) => {
                        console.log(`üìã Array[${index}]:`, {
                            type: typeof item,
                            length: Array.isArray(item) ? item.length : 'No es array',
                            sample: Array.isArray(item) && item.length > 0 ? item[0] : item
                        });
                    });
                }

                // Destructurar los 5 arrays que devuelve retrieveCommits (incluyendo commitCID)
                if (commitsData.length !== 5) {
                    throw new Error(`retrieveCommits devolvi√≥ ${commitsData.length} arrays, se esperaban exactamente 5: [messages, timestamps, committers, status, commitCID]`);
                }

                const [messages, timestamps, committers, statuses, commitCIDs] = commitsData;

                console.log('üìã Arrays destructurados correctamente:', {
                    messages: messages ? messages.length : 'null',
                    timestamps: timestamps ? timestamps.length : 'null',
                    committers: committers ? committers.length : 'null',
                    statuses: statuses ? statuses.length : 'null',
                    commitCIDs: commitCIDs ? commitCIDs.length : 'null'
                });

                console.log('‚úÖ √âXITO: retrieveCommits S√ç devuelve CIDs individuales como 5¬∫ par√°metro');

                // Debug adicional de commitCIDs 
                console.log('üîç Debug detallado de commitCIDs:');
                console.log('  commitCIDs existe:', !!commitCIDs);
                console.log('  commitCIDs es array:', Array.isArray(commitCIDs));
                console.log('  commitCIDs length:', commitCIDs ? commitCIDs.length : 'null');
                console.log('  commitCIDs valor completo:', commitCIDs);

                if (commitCIDs && commitCIDs.length > 0) {
                    console.log('üîç CommitCIDs encontrados:');
                    commitCIDs.forEach((cid, index) => {
                        console.log(`  Commit[${index}] CID:`, {
                            value: cid,
                            type: typeof cid,
                            length: cid ? cid.length : 'null',
                            isEmpty: cid === '' || cid === '0x' || cid === '0x0',
                            toString: cid ? cid.toString() : 'null'
                        });
                    });
                } else {
                    console.log('üì≠ No hay commitCIDs en la respuesta o array vac√≠o');
                }

                // Convertir a formato manejable
                const commits = [];
                for (let i = 0; i < messages.length; i++) {
                    const status = parseInt(statuses[i].toString());
                    const timestamp = parseInt(timestamps[i].toString());
                    const rawCid = commitCIDs ? commitCIDs[i] : undefined;

                    // Debug detallado para cada commit
                    console.log(`üîç Procesando commit ${i}:`, {
                        rawCid: rawCid,
                        cidExists: !!rawCid,
                        cidType: typeof rawCid,
                        cidValue: rawCid ? rawCid.toString() : 'null',
                        cidLength: rawCid ? rawCid.length : 0,
                        cidIsEmpty: rawCid === '' || rawCid === '0x' || rawCid === '0x0'
                    });

                    // Filtrar CIDs vac√≠os o inv√°lidos
                    let finalCid = null;
                    if (rawCid && rawCid !== '' && rawCid !== '0x' && rawCid !== '0x0' && rawCid.length > 10) {
                        finalCid = rawCid.toString();
                    }

                    console.log(`  ‚û°Ô∏è CID final para commit ${i}:`, finalCid);

                    commits.push({
                        index: i,
                        message: messages[i],
                        timestamp: timestamp,
                        timestampDate: new Date(timestamp * 1000),
                        committer: committers[i],
                        status: status,
                        statusText: status === 0 ? 'pending' : status === 1 ? 'approved' : 'rejected',
                        cid: finalCid  // ‚úÖ CID procesado y validado
                    });
                }

                console.log(`üìã Total commits encontrados: ${commits.length}`);
                console.log('üìä Commits:', commits);

                // Filtrar solo commits pendientes para aprobaci√≥n
                const pendingCommits = commits.filter(c => c.status === 0);
                console.log(`‚è≥ Commits pendientes: ${pendingCommits.length}`);

                if (pendingCommits.length === 0) {
                    commitsList.innerHTML = '<div class="no-commits-message">üì≠ No hay commits pendientes de aprobaci√≥n</div>';
                    return;
                }

                // Debug antes de renderizar
                console.log('üé® Renderizando commits, debug de CIDs:');
                pendingCommits.forEach((commit, index) => {
                    console.log(`  Commit ${index}:`, {
                        index: commit.index,
                        message: commit.message,
                        cid: commit.cid,
                        cidExists: !!commit.cid,
                        cidDisplay: commit.cid ? commit.cid.substring(0, 12) + '...' : 'Sin CID'
                    });
                });

                // Renderizar commits pendientes
                const commitsHtml = pendingCommits.map(commit => `
                    <div class="commit-item">
                        <div class="commit-header">
                            <span class="commit-index">Commit #${commit.index}</span>
                            <span class="commit-status ${commit.status}">${commit.status === 'pending' ? '‚è≥ Pendiente' : '‚úÖ Aprobado'}</span>
                        </div>
                        <div class="commit-info">
                            <div class="commit-message">üí¨ ${commit.message}</div>
                            <div class="commit-details">
                                üë§ Colaborador: ${commit.committer}<br>
                                üìÖ Fecha: ${commit.timestampDate.toLocaleString()}<br>
                                üìä Estado: ${commit.statusText}<br>
                                üîó CID: ${commit.cid ? `<span style="color: #90f209;">${commit.cid.substring(0, 12)}...</span>` : '<span style="color: #888;">Sin CID</span>'}
                            </div>
                        </div>
                        <div class="commit-actions">
                            <label>üí∞ Recompensa (ETH):</label>
                            <input type="number" class="reward-input" id="reward_${commit.index}" 
                                   step="0.0001" min="0.0001" placeholder="0.001" value="0.001">
                            <button class="btn btn-small btn-success" onclick="approveCommitAction(${commit.index})">
                                ‚úÖ Aprobar
                            </button>
                            <button class="btn btn-small btn-danger" onclick="rejectCommitAction(${commit.index})" style="background: #dc3545; color: white;">
                                üö´ Rechazar
                            </button>
                        </div>
                    </div>
                `).join('');

                commitsList.innerHTML = commitsHtml;

            } catch (error) {
                console.error('‚ùå Error cargando commits:', error);
                commitsList.innerHTML = '<div class="loading-message">‚ùå Error cargando commits</div>';

                statusDiv.textContent = `‚ùå Error: ${error.message}`;
                statusDiv.className = 'status-message status-error';
                statusDiv.style.display = 'block';
            }
        }

        // Aprobar un commit espec√≠fico
        async function approveCommitAction(commitIndex) {
            try {
                if (!currentCommitsTokenId) {
                    throw new Error('Token ID no v√°lido');
                }

                const rewardInput = document.getElementById(`reward_${commitIndex}`);
                const reward = parseFloat(rewardInput.value);

                if (!reward || reward <= 0) {
                    throw new Error('Recompensa debe ser mayor a 0');
                }

                if (reward < 0.0001) {
                    throw new Error('Recompensa m√≠nima: 0.0001 ETH');
                }

                console.log(`‚úÖ Aprobando commit ${commitIndex} con recompensa ${reward} ETH...`);

                const statusDiv = document.getElementById('commitsStatus');
                statusDiv.textContent = '‚è≥ Procesando aprobaci√≥n...';
                statusDiv.className = 'status-message status-info';
                statusDiv.style.display = 'block';

                // Verificar conexi√≥n
                if (!window.blockHubWeb3 || !window.blockHubWeb3.repoFactoryContract) {
                    throw new Error('Web3 no conectado o contrato no disponible');
                }

                // Llamar approveCommit con manejo de errores mejorado
                const weiReward = window.ethers.utils.parseEther(reward.toString());
                console.log(`üí∞ Enviando recompensa: ${reward} ETH (${weiReward.toString()} Wei)`);

                let tx;
                let retryCount = 0;
                const maxRetries = 3;

                while (retryCount < maxRetries) {
                    try {
                        statusDiv.textContent = retryCount > 0 ?
                            `üîÑ Reintentando transacci√≥n... (${retryCount + 1}/${maxRetries})` :
                            'üì§ Enviando transacci√≥n...';

                        tx = await window.blockHubWeb3.repoFactoryContract.approveCommit(
                            currentCommitsTokenId,
                            commitIndex,
                            weiReward,
                            {
                                value: weiReward,
                                gasLimit: 300000  // Gas l√≠mite espec√≠fico para evitar errores
                            }
                        );

                        console.log('‚è≥ Transacci√≥n enviada:', tx.hash);
                        break; // Salir del loop si la transacci√≥n fue exitosa

                    } catch (txError) {
                        retryCount++;
                        console.warn(`‚ö†Ô∏è Intento ${retryCount} fall√≥:`, txError.message);

                        if (retryCount >= maxRetries) {
                            throw txError; // Lanzar el error despu√©s de todos los intentos
                        }

                        // Esperar antes del siguiente intento
                        await new Promise(resolve => setTimeout(resolve, 2000));
                    }
                }

                statusDiv.textContent = `‚è≥ Esperando confirmaci√≥n... TX: ${tx.hash.substring(0, 10)}...`;

                const receipt = await tx.wait();
                console.log('‚úÖ Commit aprobado:', receipt);

                // Buscar eventos
                const approvedEvent = receipt.events?.find(e => e.event === 'approvedCommit');
                const badgeEvents = receipt.events?.filter(e => e.event === 'BadgeMinted' || e.event === 'StatsUpdated');

                if (approvedEvent) {
                    console.log('üéâ Evento approvedCommit:', approvedEvent.args);
                }

                if (badgeEvents && badgeEvents.length > 0) {
                    console.log('üèÜ Badges otorgados:', badgeEvents);
                    statusDiv.textContent = `üéâ ¬°Commit aprobado! Badges otorgados. TX: ${receipt.transactionHash}`;
                } else {
                    statusDiv.textContent = `üéâ ¬°Commit aprobado exitosamente! TX: ${receipt.transactionHash}`;
                }

                statusDiv.className = 'status-message status-success';

                // Recargar lista de commits
                setTimeout(() => {
                    loadCommitsList(currentCommitsTokenId);
                }, 2000);

            } catch (error) {
                console.error('‚ùå Error aprobando commit:', error);

                const statusDiv = document.getElementById('commitsStatus');

                // Mensajes de error m√°s espec√≠ficos y √∫tiles
                let errorMessage = 'Error desconocido';

                if (error.code === -32080) {
                    errorMessage = 'üåê Error de conectividad RPC. Intenta cambiar de red y volver, o espera unos minutos. Ejecuta showRPCHelp() en consola para m√°s ayuda.';
                } else if (error.code === 4001) {
                    errorMessage = '‚ùå Transacci√≥n cancelada por el usuario.';
                } else if (error.message?.includes('insufficient funds')) {
                    errorMessage = 'üí∞ Fondos insuficientes para completar la transacci√≥n.';
                } else if (error.message?.includes('gas')) {
                    errorMessage = '‚õΩ Error de gas. Intenta aumentar el l√≠mite de gas.';
                } else if (error.message?.includes('nonce')) {
                    errorMessage = 'üîÑ Error de nonce. Intenta resetear tu cuenta MetaMask.';
                } else {
                    errorMessage = `‚ùå ${error.message || 'Error en la transacci√≥n'}`;
                }

                statusDiv.textContent = errorMessage;
                statusDiv.className = 'status-message status-error';
                statusDiv.style.display = 'block';

                // Agregar bot√≥n de reintento para errores de conectividad
                if (error.code === -32080) {
                    const retryBtn = document.createElement('button');
                    retryBtn.className = 'btn btn-small btn-secondary';
                    retryBtn.style.marginTop = '1rem';
                    retryBtn.innerHTML = 'üîÑ Reintentar';
                    retryBtn.onclick = () => {
                        retryBtn.remove();
                        approveCommitAction(commitIndex);
                    };
                    statusDiv.appendChild(retryBtn);
                }
            }
        }

        // Rechazar un commit espec√≠fico
        async function rejectCommitAction(commitIndex) {
            try {
                if (!currentCommitsTokenId) {
                    throw new Error('Token ID no v√°lido');
                }

                // Confirmar rechazo
                if (!confirm(`¬øEst√°s seguro de que quieres RECHAZAR el commit #${commitIndex}?\n\nEsta acci√≥n no se puede deshacer.`)) {
                    return;
                }

                console.log(`üö´ Rechazando commit ${commitIndex}...`);

                const statusDiv = document.getElementById('commitsStatus');
                statusDiv.textContent = '‚è≥ Procesando rechazo...';
                statusDiv.className = 'status-message status-info';
                statusDiv.style.display = 'block';

                // Verificar conexi√≥n
                if (!window.blockHubWeb3 || !window.blockHubWeb3.repoFactoryContract) {
                    throw new Error('Web3 no conectado o contrato no disponible');
                }

                // Llamar rejectCommit usando Ethers.js directamente
                const tx = await window.blockHubWeb3.repoFactoryContract.rejectCommit(
                    currentCommitsTokenId,
                    commitIndex
                );

                console.log('‚è≥ Transacci√≥n enviada:', tx.hash);
                statusDiv.textContent = `‚è≥ Transacci√≥n enviada: ${tx.hash}`;

                const receipt = await tx.wait();
                console.log('‚úÖ Commit rechazado:', receipt);

                // Buscar evento rejectedCommit
                const rejectedEvent = receipt.events?.find(e => e.event === 'rejectedCommit');
                if (rejectedEvent) {
                    console.log('üö´ Evento rejectedCommit:', rejectedEvent.args);
                }

                statusDiv.textContent = `üö´ ¬°Commit rechazado exitosamente! TX: ${receipt.transactionHash}`;
                statusDiv.className = 'status-message status-error';

                // Recargar lista de commits
                setTimeout(() => {
                    loadCommitsList(currentCommitsTokenId);
                }, 2000);

            } catch (error) {
                console.error('‚ùå Error rechazando commit:', error);

                const statusDiv = document.getElementById('commitsStatus');
                statusDiv.textContent = `‚ùå Error: ${error.message}`;
                statusDiv.className = 'status-message status-error';
                statusDiv.style.display = 'block';
            }
        }

        // Actualizar lista de commits
        async function refreshCommits() {
            if (currentCommitsTokenId) {
                await loadCommitsList(currentCommitsTokenId);
            }
        }

        // Cerrar modal al hacer clic fuera
        window.onclick = function (event) {
            const editModal = document.getElementById('editModal');
            const depositModal = document.getElementById('depositModal');
            const commitsModal = document.getElementById('commitsModal');

            if (event.target === editModal) {
                closeEditModal();
            } else if (event.target === depositModal) {
                closeDepositModal();
            } else if (event.target === commitsModal) {
                closeCommitsModal();
            }
        }

        console.log('üîß Debug function available: debugContract()');
        console.log('   Ejecuta: await debugContract() en la consola para verificar el contrato');

        // Navbar background effect on scroll
        window.addEventListener('scroll', function () {
            const navbar = document.querySelector('.navbar');
            if (window.scrollY > 100) {
                navbar.style.background = 'rgba(0, 0, 0, 0.3)';
            } else {
                navbar.style.background = 'rgba(235, 235, 235, 0.1)';
            }
        });

        // Funci√≥n para mostrar consejos sobre problemas RPC
        window.showRPCHelp = function () {
            const helpMessage = `
üåê PROBLEMAS DE CONECTIVIDAD RPC - SOLUCIONES:

1. üîÑ Cambiar de Red:
   ‚Ä¢ Ve a MetaMask ‚Üí Cambiar red ‚Üí Ethereum Mainnet
   ‚Ä¢ Espera 10 segundos y vuelve a tu red original

2. üîß Resetear MetaMask:
   ‚Ä¢ MetaMask ‚Üí Configuraci√≥n ‚Üí Avanzado ‚Üí Resetear Cuenta
   ‚Ä¢ Confirma el reset (no perder√°s fondos)

3. üì° Verificar Conexi√≥n:
   ‚Ä¢ Comprueba tu conexi√≥n a internet
   ‚Ä¢ Intenta refrescar la p√°gina

4. ‚è±Ô∏è Esperar:
   ‚Ä¢ A veces el RPC est√° congestionado
   ‚Ä¢ Espera 2-3 minutos e intenta nuevamente

5. üåê Cambiar RPC:
   ‚Ä¢ Configuraciones ‚Üí Redes ‚Üí Editar RPC
   ‚Ä¢ Usa un RPC alternativo si conoces uno

¬øSigues teniendo problemas? Intenta cerrar y abrir MetaMask.
            `;

            alert(helpMessage);
        };

        console.log('üí° Funci√≥n de ayuda RPC disponible: showRPCHelp()');
    </script>

    <!-- Modal para depositar fondos -->
    <div id="depositModal" class="modal deposit-modal">
        <div class="modal-content">
            <span class="close" onclick="closeDepositModal()">&times;</span>

            <div class="deposit-header">
                <h2>üí∞ Depositar ETH</h2>
                <div class="deposit-subtitle">Financia recompensas para colaboradores</div>
            </div>

            <div id="depositContent">
                <div class="form-group">
                    <label>üìÇ Repositorio</label>
                    <div id="depositRepoName" class="info-field"></div>
                </div>

                <div class="form-group">
                    <label>üî¢ Token ID</label>
                    <div id="depositTokenId" class="info-field"></div>
                </div>

                <div class="form-group">
                    <label>üí≥ Tu Cuenta</label>
                    <div id="depositAccount" class="info-field"></div>
                </div>

                <div class="form-group">
                    <label for="ethAmount">üí∞ Cantidad a Depositar</label>
                    <div class="deposit-amount-group">
                        <input type="number" id="ethAmount" class="form-input" step="0.0001" min="0.0001"
                            placeholder="0.001" required>
                        <span class="eth-symbol">ETH</span>
                    </div>
                    <div class="quick-amounts">
                        <span class="quick-amount" onclick="setQuickAmount(0.001)">0.001 ETH</span>
                        <span class="quick-amount" onclick="setQuickAmount(0.01)">0.01 ETH</span>
                        <span class="quick-amount" onclick="setQuickAmount(0.1)">0.1 ETH</span>
                        <span class="quick-amount" onclick="setQuickAmount(1)">1 ETH</span>
                    </div>
                    <small class="form-hint">üí° M√≠nimo: 0.0001 ETH. Estos fondos se usar√°n para recompensar commits
                        aprobados</small>
                </div>

                <div id="depositStatus" class="status-message" style="display: none;"></div>

                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeDepositModal()">
                        ‚ùå Cancelar
                    </button>
                    <button type="button" class="btn btn-primary" onclick="executeDeposit()" id="depositBtn">
                        üöÄ Depositar ETH
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para aprobar commits -->
    <div id="commitsModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <span class="close" onclick="closeCommitsModal()">&times;</span>
            <h2>‚úÖ Aprobar Commits del Repositorio</h2>
            <div id="commitsContent">
                <div class="form-group">
                    <label>üìÇ Repositorio:</label>
                    <div id="commitsRepoName" class="info-field"></div>
                </div>

                <div class="form-group">
                    <label>üî¢ Token ID:</label>
                    <div id="commitsTokenId" class="info-field"></div>
                </div>

                <div class="form-group">
                    <label>üí≥ Tu cuenta (Due√±o):</label>
                    <div id="commitsAccount" class="info-field"></div>
                </div>

                <div class="form-group">
                    <label>üìã Commits Pendientes:</label>
                    <div id="commitsList" class="commits-list">
                        <div class="loading-message">üîÑ Cargando commits...</div>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeCommitsModal()">
                        ‚ùå Cerrar
                    </button>
                    <button type="button" class="btn btn-primary" onclick="refreshCommits()" id="refreshCommitsBtn">
                        üîÑ Actualizar Lista
                    </button>
                </div>

                <div id="commitsStatus" class="status-message" style="display: none;"></div>
            </div>
        </div>
    </div>

</body>

</html>