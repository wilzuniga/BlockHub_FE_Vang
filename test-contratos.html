<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Contratos - BlockHub</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #0a0a0a;
            color: #00ff00;
            padding: 20px;
            line-height: 1.6;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: #000;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #00ff00;
        }
        .address-card {
            background: #111;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }
        .success { color: #00ff00; font-weight: bold; }
        .error { color: #ff0000; font-weight: bold; }
        .warning { color: #ffaa00; font-weight: bold; }
        .info { color: #00aaff; font-weight: bold; }
        button {
            background: #00ff00;
            color: #000;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 5px;
            font-weight: bold;
            margin: 5px;
        }
        button:hover { background: #00aa00; }
        .code {
            background: #1a1a1a;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #333;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ Test Contratos BlockHub</h1>
        <p>VerificaciÃ³n de conexiÃ³n con los contratos desplegados</p>

        <div class="address-card">
            <h3>ğŸ“‹ Direcciones de Contratos</h3>
            <div class="code">
                <strong>RepoFactory:</strong> <br>
                <strong>POAP:</strong> 0x4b74468BCC47b92ffE6BD98989afF558536Eb1Af
            </div>
        </div>

        <div class="address-card">
            <h3>ğŸ”§ Tests Disponibles</h3>
            <button onclick="testInitialization()">1. ğŸ”Œ Test InicializaciÃ³n</button>
            <button onclick="testRemixStyle()">2. ğŸ¯ Test Estilo Remix</button>
            <button onclick="testCreateRepo()">3. ğŸ“ Test Crear Repositorio</button>
            <button onclick="showContractInfo()">4. ğŸ“‹ Mostrar Info Contratos</button>
        </div>

        <div class="address-card">
            <h3>ğŸ“Š Resultados</h3>
            <div id="results" class="code">
                Esperando tests...
            </div>
        </div>

        <div class="address-card">
            <h3>ğŸ” Test Manual (Consola)</h3>
            <div class="code">
// 1. Inicializar estilo Remix
await initializeRemixStyle();

// 2. Verificar conexiÃ³n
checkConnection();

// 3. Crear repositorio de prueba
await createRepository("test-repo", "QmTestCID123");

// 4. Ver informaciÃ³n de cuenta
await getAccountInfo();
            </div>
        </div>
    </div>

    <!-- Scripts necesarios -->
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    <script src="blockhub-remix-style.js"></script>

    <script>
        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const timestamp = new Date().toLocaleTimeString();
            const colorClass = type === 'error' ? 'error' : 
                              type === 'success' ? 'success' : 
                              type === 'warning' ? 'warning' : 'info';
            
            results.innerHTML += `<span class="${colorClass}">[${timestamp}] ${message}</span><br>`;
            results.scrollTop = results.scrollHeight;
        }

        async function testInitialization() {
            try {
                log('ğŸ”„ Iniciando test de inicializaciÃ³n...', 'info');
                
                // Verificar MetaMask
                if (typeof window.ethereum === 'undefined') {
                    log('âŒ MetaMask no detectado', 'error');
                    return;
                }
                log('âœ… MetaMask detectado', 'success');

                // Verificar Ethers.js
                if (typeof ethers === 'undefined') {
                    log('âŒ Ethers.js no cargado', 'error');
                    return;
                }
                log('âœ… Ethers.js disponible', 'success');

                // Verificar funciones
                if (typeof initializeRemixStyle === 'undefined') {
                    log('âŒ Funciones BlockHub no disponibles', 'error');
                    return;
                }
                log('âœ… Funciones BlockHub disponibles', 'success');

                log('ğŸ‰ Test de inicializaciÃ³n EXITOSO', 'success');

            } catch (error) {
                log(`âŒ Error en inicializaciÃ³n: ${error.message}`, 'error');
            }
        }

        async function testRemixStyle() {
            try {
                log('ğŸ”„ Probando inicializaciÃ³n estilo Remix...', 'info');
                
                const result = await initializeRemixStyle();
                
                log('âœ… InicializaciÃ³n Remix exitosa', 'success');
                log(`ğŸ”— Cuenta: ${result.address.substring(0, 8)}...`, 'info');
                
                // Verificar contratos
                if (window.factoryContract) {
                    log('âœ… Factory Contract cargado', 'success');
                    log(`ğŸ“ DirecciÃ³n: ${FACTORY_ADDRESS}`, 'info');
                } else {
                    log('âŒ Factory Contract no disponible', 'error');
                }

                if (window.poapContract) {
                    log('âœ… POAP Contract cargado', 'success');
                    log(`ğŸ“ DirecciÃ³n: ${POAP_ADDRESS}`, 'info');
                } else {
                    log('âŒ POAP Contract no disponible', 'error');
                }

            } catch (error) {
                log(`âŒ Error en test Remix: ${error.message}`, 'error');
            }
        }

        async function testCreateRepo() {
            try {
                log('ğŸ”„ Probando creaciÃ³n de repositorio...', 'info');
                
                // Verificar si estÃ¡ inicializado
                if (!checkConnection()) {
                    log('âš ï¸ Ejecutando inicializaciÃ³n primero...', 'warning');
                    await initializeRemixStyle();
                }

                // Crear repositorio de prueba
                const testName = "test-repo-" + Date.now();
                const testCID = "QmTestCID" + Math.random().toString(36).substring(2, 8);
                
                log(`ğŸ“ Creando repositorio: ${testName}`, 'info');
                log(`ğŸ”— CID: ${testCID}`, 'info');
                
                const result = await createRepository(testName, testCID);
                
                if (result.success) {
                    log('ğŸ‰ Â¡Repositorio creado exitosamente!', 'success');
                    log(`ğŸ†” Token ID: ${result.tokenId}`, 'success');
                    log(`ğŸ“„ TX: ${result.transactionHash.substring(0, 10)}...`, 'info');
                    log(`â›½ Gas usado: ${result.gasUsed}`, 'info');
                } else {
                    log('âŒ CreaciÃ³n de repositorio fallÃ³', 'error');
                }

            } catch (error) {
                log(`âŒ Error creando repositorio: ${error.message}`, 'error');
            }
        }

        async function showContractInfo() {
            try {
                log('ğŸ”„ Obteniendo informaciÃ³n de contratos...', 'info');
                
                if (!checkConnection()) {
                    log('âš ï¸ Inicializando primero...', 'warning');
                    await initializeRemixStyle();
                }

                const accountInfo = await getAccountInfo();
                
                log('ğŸ“Š INFORMACIÃ“N DE CONEXIÃ“N:', 'info');
                log(`ğŸ‘¤ Cuenta: ${accountInfo.address}`, 'info');
                log(`ğŸ’° Balance: ${accountInfo.balance} ETH`, 'info');
                log(`ğŸŒ Red: ${accountInfo.network} (${accountInfo.chainId})`, 'info');
                log(`ğŸ­ Factory: ${FACTORY_ADDRESS}`, 'info');
                log(`ğŸ† POAP: ${POAP_ADDRESS}`, 'info');

            } catch (error) {
                log(`âŒ Error obteniendo info: ${error.message}`, 'error');
            }
        }

        // InicializaciÃ³n automÃ¡tica
        window.addEventListener('load', () => {
            log('ğŸš€ Test de contratos BlockHub iniciado', 'success');
            log('ğŸ‘† Haz clic en los botones para ejecutar tests', 'info');
            log('ğŸ” TambiÃ©n puedes usar la consola del navegador', 'info');
        });
    </script>
</body>
</html>
